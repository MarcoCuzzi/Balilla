<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo Calcio Balilla</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #d1fae5 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card h2 {
            font-size: 20px;
            color: #1f2937;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: border 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #059669;
        }

        button {
            padding: 14px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #059669;
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #047857;
        }

        .btn-secondary {
            background: #10b981;
            color: white;
            width: 100%;
        }

        .btn-secondary:hover {
            background: #059669;
        }

        .btn-export {
            background: #3b82f6;
            color: white;
            width: 100%;
        }

        .btn-export:hover {
            background: #2563eb;
        }

        .btn-reset {
            background: rgba(255,255,255,0.2);
            color: white;
            width: auto;
            padding: 10px;
            border-radius: 8px;
        }

        .btn-reset:hover {
            background: rgba(255,255,255,0.3);
        }

        .btn-icon {
            background: transparent;
            color: #6b7280;
            width: auto;
            padding: 8px;
            font-size: 18px;
            min-width: 40px;
        }

        .btn-icon:hover {
            background: #f3f4f6;
        }

        .btn-icon.delete:hover {
            background: #fee2e2;
            color: #dc2626;
        }

        .btn-icon.edit:hover {
            background: #dbeafe;
            color: #2563eb;
        }

        .team-item {
            background: #f0fdf4;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-info {
            flex: 1;
        }

        .team-attacker {
            font-weight: bold;
            color: #1f2937;
            font-size: 16px;
        }

        .team-goalkeeper {
            color: #6b7280;
            font-size: 14px;
        }

        .team-actions {
            display: flex;
            gap: 5px;
        }

        .score-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .score-inputs input {
            text-align: center;
            font-weight: bold;
            font-size: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: #059669;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        td {
            font-size: 14px;
        }

        .text-center {
            text-align: center !important;
        }

        .winner-row {
            background: #fef3c7 !important;
        }

        .points {
            color: #059669;
            font-weight: bold;
            font-size: 16px;
        }

        .match-item {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #059669;
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .match-team {
            flex: 1;
            font-weight: bold;
            color: #1f2937;
        }

        .match-score {
            font-size: 24px;
            font-weight: bold;
            color: #059669;
            margin: 0 15px;
        }

        .match-date {
            font-size: 12px;
            color: #6b7280;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .match-actions {
            display: flex;
            gap: 5px;
        }

        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }

        .editing {
            background: #dbeafe !important;
            border-left-color: #3b82f6 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <span class="icon">üèÜ</span>
                Torneo Calcio Balilla
            </h1>
            <button class="btn-reset" onclick="resetTournament()">
                <span class="icon">üîÑ</span>
            </button>
        </div>

        <!-- Aggiungi/Modifica Squadra -->
        <div class="card">
            <h2><span class="icon">üë•</span> <span id="teamFormTitle">Nuova Squadra</span></h2>
            <input type="text" id="attacker" placeholder="Nome Attaccante">
            <input type="text" id="goalkeeper" placeholder="Nome Portiere">
            <button class="btn-primary" id="saveTeamBtn" onclick="saveTeam()">
                <span class="icon">‚ûï</span>
                <span id="saveTeamText">Aggiungi Squadra</span>
            </button>
            <button class="btn-secondary" id="cancelTeamBtn" onclick="cancelEditTeam()" style="display: none; margin-top: 10px;">
                Annulla Modifica
            </button>
        </div>

        <!-- Lista Squadre -->
        <div id="teamsList"></div>

        <!-- Inserisci/Modifica Partita -->
        <div id="matchForm"></div>

        <!-- Classifica -->
        <div id="standings"></div>

        <!-- Partite -->
        <div id="matchesList"></div>

        <!-- Esporta -->
        <div id="exportButton"></div>
    </div>

    <script>
        let teams = [];
        let matches = [];
        let editingTeamId = null;
        let editingMatchId = null;

        // Carica dati salvati
        function loadData() {
            const savedTeams = localStorage.getItem('foosball_teams');
            const savedMatches = localStorage.getItem('foosball_matches');
            if (savedTeams) teams = JSON.parse(savedTeams);
            if (savedMatches) matches = JSON.parse(savedMatches);
            render();
        }

        // Salva dati
        function saveData() {
            localStorage.setItem('foosball_teams', JSON.stringify(teams));
            localStorage.setItem('foosball_matches', JSON.stringify(matches));
        }

        // Salva squadra (aggiungi o modifica)
        function saveTeam() {
            const attacker = document.getElementById('attacker').value.trim();
            const goalkeeper = document.getElementById('goalkeeper').value.trim();
            
            if (attacker && goalkeeper) {
                if (editingTeamId) {
                    // Modifica squadra esistente
                    const team = teams.find(t => t.id === editingTeamId);
                    team.attacker = attacker;
                    team.goalkeeper = goalkeeper;
                    team.name = `${attacker} / ${goalkeeper}`;
                    
                    // Aggiorna anche i nomi nelle partite
                    matches.forEach(match => {
                        if (match.team1Id === editingTeamId) {
                            match.team1Name = team.name;
                        }
                        if (match.team2Id === editingTeamId) {
                            match.team2Name = team.name;
                        }
                    });
                    
                    editingTeamId = null;
                } else {
                    // Aggiungi nuova squadra
                    teams.push({
                        id: Date.now(),
                        attacker: attacker,
                        goalkeeper: goalkeeper,
                        name: `${attacker} / ${goalkeeper}`
                    });
                }
                
                document.getElementById('attacker').value = '';
                document.getElementById('goalkeeper').value = '';
                document.getElementById('teamFormTitle').textContent = 'Nuova Squadra';
                document.getElementById('saveTeamText').textContent = 'Aggiungi Squadra';
                document.getElementById('cancelTeamBtn').style.display = 'none';
                
                saveData();
                render();
            }
        }

        // Modifica squadra
        function editTeam(id) {
            const team = teams.find(t => t.id === id);
            if (team) {
                editingTeamId = id;
                document.getElementById('attacker').value = team.attacker;
                document.getElementById('goalkeeper').value = team.goalkeeper;
                document.getElementById('teamFormTitle').textContent = 'Modifica Squadra';
                document.getElementById('saveTeamText').textContent = 'Salva Modifiche';
                document.getElementById('cancelTeamBtn').style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Annulla modifica squadra
        function cancelEditTeam() {
            editingTeamId = null;
            document.getElementById('attacker').value = '';
            document.getElementById('goalkeeper').value = '';
            document.getElementById('teamFormTitle').textContent = 'Nuova Squadra';
            document.getElementById('saveTeamText').textContent = 'Aggiungi Squadra';
            document.getElementById('cancelTeamBtn').style.display = 'none';
        }

        // Elimina squadra
        function deleteTeam(id) {
            if (confirm('Vuoi eliminare questa squadra? Verranno eliminate anche tutte le sue partite.')) {
                teams = teams.filter(t => t.id !== id);
                matches = matches.filter(m => m.team1Id !== id && m.team2Id !== id);
                if (editingTeamId === id) {
                    cancelEditTeam();
                }
                saveData();
                render();
            }
        }

        // Salva partita (aggiungi o modifica)
        function saveMatch() {
            const team1Id = parseInt(document.getElementById('team1').value);
            const team2Id = parseInt(document.getElementById('team2').value);
            const score1 = parseInt(document.getElementById('score1').value) || 0;
            const score2 = parseInt(document.getElementById('score2').value) || 0;

            if (team1Id && team2Id && team1Id !== team2Id) {
                const team1 = teams.find(t => t.id === team1Id);
                const team2 = teams.find(t => t.id === team2Id);

                if (editingMatchId) {
                    // Modifica partita esistente
                    const match = matches.find(m => m.id === editingMatchId);
                    match.team1Id = team1.id;
                    match.team2Id = team2.id;
                    match.team1Name = team1.name;
                    match.team2Name = team2.name;
                    match.score1 = score1;
                    match.score2 = score2;
                    
                    editingMatchId = null;
                } else {
                    // Aggiungi nuova partita
                    matches.push({
                        id: Date.now(),
                        team1Id: team1.id,
                        team2Id: team2.id,
                        team1Name: team1.name,
                        team2Name: team2.name,
                        score1: score1,
                        score2: score2,
                        date: new Date().toLocaleString('it-IT')
                    });
                }

                document.getElementById('score1').value = 0;
                document.getElementById('score2').value = 0;
                saveData();
                render();
            }
        }

        // Modifica partita
        function editMatch(id) {
            const match = matches.find(m => m.id === id);
            if (match) {
                editingMatchId = id;
                document.getElementById('team1').value = match.team1Id;
                document.getElementById('team2').value = match.team2Id;
                document.getElementById('score1').value = match.score1;
                document.getElementById('score2').value = match.score2;
                document.getElementById('matchFormTitle').textContent = 'Modifica Partita';
                document.getElementById('saveMatchText').textContent = 'Salva Modifiche';
                document.getElementById('cancelMatchBtn').style.display = 'block';
                
                // Scorri al form
                document.getElementById('matchForm').scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                render();
            }
        }

        // Annulla modifica partita
        function cancelEditMatch() {
            editingMatchId = null;
            document.getElementById('score1').value = 0;
            document.getElementById('score2').value = 0;
            document.getElementById('matchFormTitle').textContent = 'Nuova Partita';
            document.getElementById('saveMatchText').textContent = 'Salva Partita';
            document.getElementById('cancelMatchBtn').style.display = 'none';
            render();
        }

        // Elimina partita
        function deleteMatch(id) {
            if (confirm('Vuoi eliminare questa partita?')) {
                matches = matches.filter(m => m.id !== id);
                if (editingMatchId === id) {
                    cancelEditMatch();
                }
                saveData();
                render();
            }
        }

        // Calcola classifica
        function getStandings() {
            const standings = {};
            
            teams.forEach(team => {
                standings[team.id] = {
                    name: team.name,
                    played: 0,
                    won: 0,
                    lost: 0,
                    draw: 0,
                    goalsFor: 0,
                    goalsAgainst: 0,
                    points: 0
                };
            });

            matches.forEach(match => {
                if (standings[match.team1Id] && standings[match.team2Id]) {
                    standings[match.team1Id].played++;
                    standings[match.team2Id].played++;
                    standings[match.team1Id].goalsFor += match.score1;
                    standings[match.team1Id].goalsAgainst += match.score2;
                    standings[match.team2Id].goalsFor += match.score2;
                    standings[match.team2Id].goalsAgainst += match.score1;

                    if (match.score1 > match.score2) {
                        standings[match.team1Id].won++;
                        standings[match.team1Id].points += 3;
                        standings[match.team2Id].lost++;
                    } else if (match.score2 > match.score1) {
                        standings[match.team2Id].won++;
                        standings[match.team2Id].points += 3;
                        standings[match.team1Id].lost++;
                    } else {
                        standings[match.team1Id].draw++;
                        standings[match.team2Id].draw++;
                        standings[match.team1Id].points += 1;
                        standings[match.team2Id].points += 1;
                    }
                }
            });

            return Object.values(standings)
                .sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    const diffA = a.goalsFor - a.goalsAgainst;
                    const diffB = b.goalsFor - b.goalsAgainst;
                    if (diffB !== diffA) return diffB - diffA;
                    return b.goalsFor - a.goalsFor;
                });
        }

        // Reset torneo
        function resetTournament() {
            if (confirm('Vuoi davvero resettare tutto il torneo? Questa azione non pu√≤ essere annullata.')) {
                teams = [];
                matches = [];
                editingTeamId = null;
                editingMatchId = null;
                localStorage.removeItem('foosball_teams');
                localStorage.removeItem('foosball_matches');
                cancelEditTeam();
                render();
            }
        }

        // Esporta risultati
        function exportResults() {
            const standings = getStandings();
            
            let html = `<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risultati Torneo Calcio Balilla</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #f9fafb;
        }
        h1 {
            color: #059669;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #047857;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 3px solid #059669;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        th {
            background: #059669;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        tr:nth-child(even) {
            background: #f9fafb;
        }
        tr:first-child td {
            background: #fef3c7 !important;
            font-weight: bold;
        }
        .match {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #059669;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .match-score {
            font-size: 20px;
            font-weight: bold;
            color: #059669;
        }
        .match-date {
            color: #6b7280;
            font-size: 14px;
            margin-top: 5px;
        }
        .text-center {
            text-align: center;
        }
        @media print {
            body {
                margin: 0;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <h1>üèÜ Torneo Calcio Balilla - Risultati Finali üèÜ</h1>
    
    <h2>üìä Classifica Finale</h2>
    <table>
        <thead>
            <tr>
                <th>Pos</th>
                <th>Squadra</th>
                <th class="text-center">PG</th>
                <th class="text-center">V</th>
                <th class="text-center">N</th>
                <th class="text-center">P</th>
                <th class="text-center">GF</th>
                <th class="text-center">GS</th>
                <th class="text-center">Diff</th>
                <th class="text-center">Punti</th>
            </tr>
        </thead>
        <tbody>`;

            standings.forEach((team, idx) => {
                html += `
            <tr>
                <td><strong>${idx + 1}</strong></td>
                <td>${team.name}</td>
                <td class="text-center">${team.played}</td>
                <td class="text-center">${team.won}</td>
                <td class="text-center">${team.draw}</td>
                <td class="text-center">${team.lost}</td>
                <td class="text-center">${team.goalsFor}</td>
                <td class="text-center">${team.goalsAgainst}</td>
                <td class="text-center">${team.goalsFor - team.goalsAgainst}</td>
                <td class="text-center"><strong>${team.points}</strong></td>
            </tr>`;
            });

            html += `
        </tbody>
    </table>

    <h2>‚öΩ Partite Giocate</h2>`;

            matches.forEach(match => {
                html += `
    <div class="match">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="flex: 1;"><strong>${match.team1Name}</strong></div>
            <div class="match-score">${match.score1} - ${match.score2}</div>
            <div style="flex: 1; text-align: right;"><strong>${match.team2Name}</strong></div>
        </div>
        <div class="match-date">${match.date}</div>
    </div>`;
            });

            html += `
</body>
</html>`;

            // Crea e scarica il file
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'risultati-torneo-calciobalilla.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Render
        function render() {
            // Lista squadre
            const teamsHtml = teams.length > 0 ? `
                <div class="card">
                    <h2><span class="icon">üìã</span> Squadre Iscritte</h2>
                    ${teams.map(team => `
                        <div class="team-item">
                            <div class="team-info">
                                <div class="team-attacker">${team.attacker}</div>
                                <div class="team-goalkeeper">${team.goalkeeper}</div>
                            </div>
                            <div class="team-actions">
                                <button class="btn-icon edit" onclick="editTeam(${team.id})" title="Modifica">‚úèÔ∏è</button>
                                <button class="btn-icon delete" onclick="deleteTeam(${team.id})" title="Elimina">‚úñÔ∏è</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            ` : '';
            document.getElementById('teamsList').innerHTML = teamsHtml;

            // Form partita
            const matchFormHtml = teams.length >= 2 ? `
                <div class="card">
                    <h2><span class="icon">‚öΩ</span> <span id="matchFormTitle">${editingMatchId ? 'Modifica Partita' : 'Nuova Partita'}</span></h2>
                    <select id="team1">
                        <option value="">Seleziona Squadra 1</option>
                        ${teams.map(team => `<option value="${team.id}">${team.name}</option>`).join('')}
                    </select>
                    <div class="score-inputs">
                        <input type="number" id="score1" value="0" min="0">
                        <input type="number" id="score2" value="0" min="0">
                    </div>
                    <select id="team2">
                        <option value="">Seleziona Squadra 2</option>
                        ${teams.map(team => `<option value="${team.id}">${team.name}</option>`).join('')}
                    </select>
                    <button class="btn-secondary" onclick="saveMatch()">
                        <span id="saveMatchText">${editingMatchId ? 'Salva Modifiche' : 'Salva Partita'}</span>
                    </button>
                    <button class="btn-primary" id="cancelMatchBtn" onclick="cancelEditMatch()" style="display: ${editingMatchId ? 'flex' : 'none'}; margin-top: 10px;">
                        Annulla Modifica
                    </button>
                </div>
            ` : '';
            document.getElementById('matchForm').innerHTML = matchFormHtml;

            // Classifica
            const standings = getStandings();
            const hasPlayedMatches = standings.length > 0 && standings[0].played > 0;
            const standingsHtml = hasPlayedMatches ? `
                <div class="card">
                    <h2><span class="icon">üèÖ</span> Classifica</h2>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Squadra</th>
                                    <th class="text-center">PT</th>
                                    <th class="text-center">V</th>
                                    <th class="text-center">GF</th>
                                    <th class="text-center">GS</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${standings.map((team, idx) => `
                                    <tr ${idx === 0 ? 'class="winner-row"' : ''}>
                                        <td><strong>${idx + 1}</strong></td>
                                        <td>${team.name}</td>
                                        <td class="text-center points">${team.points}</td>
                                        <td class="text-center">${team.won}</td>
                                        <td class="text-center">${team.goalsFor}</td>
                                        <td class="text-center">${team.goalsAgainst}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            ` : '';
            document.getElementById('standings').innerHTML = standingsHtml;

            // Lista partite
            const matchesHtml = matches.length > 0 ? `
                <div class="card">
                    <h2><span class="icon">üìÖ</span> Partite Giocate</h2>
                    ${[...matches].reverse().map(match => `
                        <div class="match-item ${editingMatchId === match.id ? 'editing' : ''}">
                            <div class="match-teams">
                                <div class="match-team">${match.team1Name}</div>
                                <div class="match-score">${match.score1} - ${match.score2}</div>
                                <div class="match-team" style="text-align: right;">${match.team2Name}</div>
                            </div>
                            <div class="match-date">
                                <span>${match.date}</span>
                                <div class="match-actions">
                                    <button class="btn-icon edit" onclick="editMatch(${match.id})" title="Modifica">‚úèÔ∏è</button>
                                    <button class="btn-icon delete" onclick="deleteMatch(${match.id})" title="Elimina">‚úñÔ∏è</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            ` : '';
            document.getElementById('matchesList').innerHTML = matchesHtml;

            // Pulsante esporta
            const exportHtml = matches.length > 0 ? `
                <button class="btn-export" onclick="exportResults()">
                    <span class="icon">üì•</span>
                    Esporta Risultati HTML
                </button>
            ` : '';
            document.getElementById('exportButton').innerHTML = exportHtml;
        }

        // Carica dati all'avvio
        loadData();
    </script>
</body>
</html>